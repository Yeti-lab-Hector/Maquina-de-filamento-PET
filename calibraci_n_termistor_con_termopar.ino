

#include "max6675.h"
// CONFIGURACION DE LOS PINES UTILIZADOS PARA LA COMUNICACIÓN CON EL MAX6675

#define CONFIG_TCSCK_PIN      10
#define CONFIG_TCCS_PIN       11
#define CONFIG_TCDO_PIN       12
 
// OBJETO UTILIZADO PARA LA COMUNICACION CON EL MAX6675
MAX6675 thermocouple(CONFIG_TCSCK_PIN, CONFIG_TCCS_PIN, CONFIG_TCDO_PIN);

uint16_t temptable  [102][2] =
// Thermistor: EPCOS B57560G104F
{
{1, 3318}, // 829.50 C
{11, 1582}, // 395.50 C
{21, 1189}, // 297.25 C
{31, 1125}, // 281.25 C
{41, 1075}, // 268.75 C
{51, 1031}, // 257.75 C
{61, 996}, // 249.00 C
{71, 960}, // 240.00 C
{81, 935}, // 233.75 C
{91, 911}, // 227.75 C
{101, 883}, // 220.75 C
{111, 866}, // 216.50 C
{121, 847}, // 211.75 C
{131, 830}, // 207.50 C
{141, 813}, // 203.25 C
{151, 799}, // 199.75 C
{161, 786}, // 196.50 C
{171, 771}, // 192.75 C
{181, 756}, // 189.00 C
{191, 744}, // 186.00 C
{201, 734}, // 183.50 C
{211, 721}, // 180.25 C
{221, 709}, // 177.25 C
{231, 699}, // 174.75 C
{241, 692}, // 173.00 C
{251, 681}, // 170.25 C
{261, 671}, // 167.75 C
{271, 662}, // 165.50 C
{281, 654}, // 163.50 C
{291, 648}, // 162.00 C
{301, 638}, // 159.50 C
{311, 627}, // 156.75 C
{321, 622}, // 155.50 C
{331, 612}, // 153.00 C
{341, 606}, // 151.50 C
{351, 598}, // 149.50 C
{361, 589}, // 147.25 C
{371, 579}, // 144.75 C
{381, 575}, // 143.75 C
{391, 568}, // 142.00 C
{401, 560}, // 140.00 C
{411, 552}, // 138.00 C
{421, 547}, // 136.75 C
{431, 541}, // 135.25 C
{441, 534}, // 133.50 C
{451, 527}, // 131.75 C
{461, 520}, // 130.00 C
{471, 512}, // 128.00 C
{481, 505}, // 126.25 C
{491, 502}, // 125.50 C
{501, 495}, // 123.75 C
{511, 486}, // 121.50 C
{521, 484}, // 121.00 C
{531, 478}, // 119.50 C
{541, 471}, // 117.75 C
{551, 468}, // 117.00 C
{561, 460}, // 115.00 C
{571, 454}, // 113.50 C
{581, 448}, // 112.00 C
{591, 441}, // 110.25 C
{601, 435}, // 108.75 C
{611, 428}, // 107.00 C
{621, 423}, // 105.75 C
{631, 418}, // 104.50 C
{641, 410}, // 102.50 C
{651, 406}, // 101.50 C
{661, 400}, // 100.00 C
{671, 390}, // 97.50 C
{681, 387}, // 96.75 C
{691, 378}, // 94.50 C
{701, 372}, // 93.00 C
{711, 367}, // 91.75 C
{721, 358}, // 89.50 C
{731, 352}, // 88.00 C
{741, 344}, // 86.00 C
{751, 336}, // 84.00 C
{761, 328}, // 82.00 C
{771, 321}, // 80.25 C
{781, 315}, // 78.75 C
{791, 312}, // 78.00 C
{801, 304}, // 76.00 C
{811, 298}, // 74.50 C
{821, 292}, // 73.00 C
{831, 280}, // 70.00 C
{841, 276}, // 69.00 C
{851, 266}, // 66.50 C
{861, 258}, // 64.50 C
{871, 248}, // 62.00 C
{881, 236}, // 59.00 C
{891, 226}, // 56.50 C
{901, 212}, // 53.00 C
{911, 203}, // 50.75 C
{921, 192}, // 48.00 C
{931, 179}, // 44.75 C
{941, 165}, // 41.25 C
{951, 150}, // 37.50 C
{961, 136}, // 34.00 C
{971, 112}, // 28.00 C
{981, 87}, // 21.75 C
{991, 53}, // 13.25 C
{1001, 41}, // 10.25 C
{1011, 4}, // 1.00 C
};
/*uint16_t temptable  [102][2] = 
// Thermistor: EPCOS B57560G104F
{
   {1, 3318}, // 829.616016745 C
   {11, 1582}, // 395.653631407 C
   {21, 1323}, // 330.84097107 C
   {31, 1188}, // 297.209646621 C
   {41, 1100}, // 275.07218256 C
   {51, 1035}, // 258.789398125 C
   {61, 984}, // 246.008594145 C
   {71, 942}, // 235.537654412 C
   {81, 906}, // 226.694443884 C
   {91, 876}, // 219.054455222 C
   {101, 849}, // 212.336691817 C
   {111, 825}, // 206.346127832 C
   {121, 803}, // 200.942223904 C
   {131, 784}, // 196.020563493 C
   {141, 766}, // 191.50157718 C
   {151, 749}, // 187.323319967 C
   {161, 733}, // 183.436677733 C
   {171, 719}, // 179.802088411 C
   {181, 705}, // 176.387240163 C
   {191, 692}, // 173.165418421 C
   {201, 680}, // 170.114295013 C
   {211, 668}, // 167.215025351 C
   {221, 657}, // 164.451564622 C
   {231, 647}, // 161.810142471 C
   {241, 637}, // 159.278854262 C
   {251, 627}, // 156.847339317 C
   {261, 618}, // 154.50652494 C
   {271, 608}, // 152.248420783 C
   {281, 600}, // 150.065952166 C
   {291, 591}, // 147.952823858 C
   {301, 583}, // 145.903407888 C
   {311, 575}, // 143.912650487 C
   {321, 567}, // 141.975994383 C
   {331, 560}, // 140.089313499 C
   {341, 552}, // 138.248857757 C
   {351, 545}, // 136.451206156 C
   {361, 538}, // 134.693226674 C
   {371, 531}, // 132.972041812 C
   {381, 525}, // 131.284998864 C
   {391, 518}, // 129.629644111 C
   {401, 512}, // 128.003700342 C
   {411, 505}, // 126.405047164 C
   {421, 499}, // 124.831703684 C
   {431, 493}, // 123.281813201 C
   {441, 487}, // 121.753629616 C
   {451, 480}, // 120.2455053 C
   {461, 475}, // 118.755880215 C
   {471, 469}, // 117.283272105 C
   {481, 463}, // 115.826267593 C
   {491, 457}, // 114.383514072 C
   {501, 451}, // 112.953712236 C
   {511, 446}, // 111.535609196 C
   {521, 440}, // 110.127992041 C
   {531, 434}, // 108.729681803 C
   {541, 429}, // 107.339527723 C
   {551, 423}, // 105.956401766 C
   {561, 418}, // 104.579193313 C
   {571, 412}, // 103.206803975 C
   {581, 407}, // 101.838142455 C
   {591, 401}, // 100.472119415 C
   {601, 396}, // 99.1076422777 C
   {611, 390}, // 97.7436098948 C
   {621, 385}, // 96.3789070256 C
   {631, 380}, // 95.0123985415 C
   {641, 374}, // 93.6429232791 C
   {651, 369}, // 92.2692874506 C
   {661, 363}, // 90.8902575047 C
   {671, 358}, // 89.5045523189 C
   {681, 352}, // 88.1108345795 C
   {691, 346}, // 86.7077011852 C
   {701, 341}, // 85.2936724726 C
   {711, 335}, // 83.8671800249 C
   {721, 329}, // 82.4265527738 C
   {731, 323}, // 80.9700010386 C
   {741, 317}, // 79.4955980642 C
   {751, 312}, // 78.0012585145 C
   {761, 305}, // 76.4847132388 C
   {771, 299}, // 74.9434794495 C
   {781, 293}, // 73.3748252113 C
   {791, 287}, // 71.7757268294 C
   {801, 280}, // 70.1428172972 C
   {811, 273}, // 68.4723233868 C
   {821, 267}, // 66.7599881711 C
   {831, 260}, // 65.0009746545 C
   {841, 252}, // 63.189744608 C
   {851, 245}, // 61.3199044379 C
   {861, 237}, // 59.3840065713 C
   {871, 229}, // 57.3732898485 C
   {881, 221}, // 55.2773347518 C
   {891, 212}, // 53.0835972837 C
   {901, 203}, // 50.7767658983 C
   {911, 193}, // 48.3378535447 C
   {921, 182}, // 45.7428809535 C
   {931, 171}, // 42.9609064421 C
   {941, 159}, // 39.9509663295 C
   {951, 146}, // 36.6571055471 C
   {961, 131}, // 32.9998468755 C
   {971, 115}, // 28.8604816153 C
   {981, 96}, // 24.0493448775 C
   {991, 72}, // 18.2330297294 C
   {1001, 42}, // 10.732298885 C
   {1010, 4} // 1.11618417895 C
};*/
int V=0,V2=0;
float Temperatura;
unsigned long tiempo;
  void setup(){
  Serial.begin(9600);
  pinMode(13,OUTPUT);
  Serial.println("Calienta a 300C para iniciar la calibración");
  Serial.println("      ................");
  V=analogRead(A0);
  V2=V;
  tiempo=millis();
  Temperatura=thermocouple.readCelsius();
  }

  
  void loop(){
    if(millis()>tiempo+1000){
      tiempo=millis();
   Temperatura=thermocouple.readCelsius();
    }
    
delay(50);
V=analogRead(A0);
if(V2<V)V2++;
else if(V2>V)V2--;

  for(int i=0;i<102;i++){
    if(V2 == temptable[i][0]){
      temptable[i][1]= uint16_t(Temperatura*4);
      Serial.print(temptable[i][0]);
      Serial.print("-->");
      Serial.println(Temperatura); 
      }
    }
    
  if(Temperatura<10)imprimeDatos();   

    }
    
      void imprimeDatos(){
        Serial.println(" ");
        Serial.println(" ");
    Serial.println("const uint16_t PROGMEM temptable  [102][2] =");
    Serial.println("// Thermistor: 100k ntc chino con pull-up 4k7");
    Serial.println("{");
    for(int i=0;i<102;i++){
      Serial.print("{");
      Serial.print(temptable[i][0]);
      Serial.print(", ");
      Serial.print(temptable[i][1]);
      Serial.print("}, // ");
      Serial.print(float(temptable[i][1])*0.25);
      Serial.println(" C");
      }
    Serial.print("};");
    while(1)delay(100);
        
        }
